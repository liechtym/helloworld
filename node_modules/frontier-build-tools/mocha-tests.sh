#!/bin/bash

echo "Testing the app"

source $HOME/.nvm/nvm.sh

# Run app tests
rm -fr docs/reports
mkdir -p docs/reports
mocha test/server/*.js -R xunit > docs/reports/mocha.xml

FAILURE_COUNT=`grep "<failure" -c docs/reports/mocha.xml`

# This is not the right test but we need some way to fail the build if a test case doesn't 
if [ "$FAILURE_COUNT" != 0 ]
then
  echo "Exiting build because of failed app tests:"
  cat docs/reports/mocha.xml
  exit -1
fi

echo "Tests passed"